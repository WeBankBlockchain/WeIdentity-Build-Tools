webpackJsonp([12],{F0QO:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=a("lC5x"),i=a.n(l),s=a("J0Oq"),o=a.n(s),n=a("/p82"),r=a("gej+"),d={data:function(){return{page:{deployList:[],pageSize:5,total:0,pageIndex:1},dialog:{dialogTableVisible:!1,dialogFormVisible:!1,dialogDetailVisible:!1,dialogDepolyDetailVisible:!1,deployForm:{groupId:1,evidenceName:""},groupList:[],deployMessages:[],hash:"",groupId:"",deployBtn:null,deployDetail:{},userListPage:{userList:[],pageSize:3,total:0,pageIndex:1}}}},methods:{showAll:function(e){this.$alert(e,"温馨提示",{}).catch(function(){})},showDeploy:function(){r.a.data.nodeStatus?(this.dialog.deployForm.evidenceName="",this.dialog.dialogFormVisible=!0):r.a.checkNodeState(!1)},showDeployDetail:function(e,t){var a=this;n.a.doGet("getShareInfo/"+e).then(function(e){0===e.data.errorCode?(a.dialog.deployDetail=e.data.result,a.dialog.deployDetail.owner=t,a.dialog.dialogDetailVisible=!0):a.$alert("部署详情查询失败!","温馨提示").catch(function(){})})},enable:function(e,t,a){var l=this;this.dialog.deployBtn=a.currentTarget;var i="是否确定在此群组（group ID : "+t+"）中使用这个 Evidence 合约地址? <br/>* 启用后将直接同步到应用环境（如果是生产环境，请特别小心）。<br/>* 每一个群组，只能有一个启用的 Evidence 合约（调用EvidenceService的createEvidence会将Evidence写入这个 Evidence 合约）。<br/>* 不同群组，可以启用不同的 Evidence 合约。";this.$confirm(i,"温馨提示",{closeOnClickModal:!1,cancelButtonClass:"el-button--primary",dangerouslyUseHTMLString:!0}).then(function(a){l.disableBtn(l.dialog.deployBtn),l.dialog.hash=e,l.dialog.groupId=t,l.dialog.deployMessages=[],l.enableShareCns()}).catch(function(){})},deleteRow:function(e,t){var a=this;this.dialog.deployBtn=t.currentTarget,this.$confirm("确认删除吗？","温馨提示",{closeOnClickModal:!1,cancelButtonClass:"el-button--primary"}).then(function(t){a.disableBtn(a.dialog.deployBtn),a.removeHash(e)}).catch(function(){})},removeHash:function(e){var t=this;n.a.doPost("removeHash/"+e+"/2").then(function(e){0===e.data.errorCode?(t.$alert("删除成功!","温馨提示").catch(function(){}),t.getShareList()):t.$alert(e.data.errorMessage,"温馨提示",{}).catch(function(){}),t.enableBtn(t.dialog.deployBtn)})},comfirmBtn:function(){this.dialog.dialogDepolyDetailVisible=!1,this.dialog.dialogFormVisible=!1},enableShareCns:function(){var e=this,t={};t.hash=this.dialog.hash,t.groupId=this.dialog.groupId,this.dialog.deployMessages.push("存证合约启用中..."),this.dialog.dialogDepolyDetailVisible=!0,n.a.doPost("enableShareCns",t,15).then(function(t){e.dialog.dialogDepolyDetailVisible=!0,0===t.data.errorCode?(e.dialog.deployMessages.push("存证合约启用成功。"),e.dialog.deployMessages.push("请继续操作。"),e.getShareList()):"fail"===t.data.result?e.dialog.deployMessages.push("存证合约启用失败。"):e.dialog.deployMessages.push("存证合约启用失败:"+t.data.errorMessage),e.enableBtn(e.dialog.deployBtn)})},isEnableEvidenceCns:function(){var e=this;n.a.doGet("isEnableEvidenceCns/"+this.dialog.groupId).then(function(t){t.data.result?e.enableShareCns():(e.dialog.deployMessages.push("请继续操作。"),e.getShareList(),e.enableBtn(e.dialog.deployBtn))})},deployEvidence:function(e){var t=this;this.dialog.deployBtn=e.currentTarget,""!==this.dialog.deployForm.evidenceName?(this.disableBtn(this.dialog.deployBtn),this.dialog.deployMessages=[],this.dialog.deployMessages.push("存证合约部署中..."),this.dialog.dialogDepolyDetailVisible=!0,n.a.doPost("deployEvidence",this.dialog.deployForm,15).then(function(e){t.dialog.dialogDepolyDetailVisible=!0,0===e.data.errorCode?(t.dialog.hash=e.data.result,t.dialog.groupId=t.dialog.deployForm.groupId,t.dialog.deployMessages.push("存证合约部署成功。"),t.isEnableEvidenceCns()):(t.dialog.deployMessages.push("存证合约部署失败! 请查看日志。"),t.enableBtn(t.dialog.deployBtn))})):this.$alert("请输入存证应用名!","温馨提示").catch(function(){})},indexChange:function(e){e<1&&(e=1),this.page.pageIndex=e},getShareList:function(){var e=this;n.a.doGet("getShareList").then(function(t){0===t.data.errorCode&&(e.page.deployList=t.data.result,e.page.total=e.page.deployList.length,0!==e.page.total&&e.page.total===e.page.pageSize*(e.page.pageIndex-1)&&e.indexChange(e.page.pageIndex-1))})},indexChange2:function(e){this.dialog.userListPage.pageIndex=e},getUserListByHash:function(e){var t=this;n.a.doGet("getUserListByHash/"+e).then(function(e){0===e.data.errorCode&&(t.dialog.userListPage.userList=e.data.result,t.dialog.userListPage.total=e.data.result.length,t.dialog.dialogTableVisible=!0)})},init:function(){var e=this;n.a.doGet("getAllGroup/true").then(function(t){0===t.data.errorCode?(e.dialog.groupList=t.data.result,e.dialog.deployForm.groupId=e.dialog.groupList[0].value):e.$alert("启用列表失败!","温馨提示").catch(function(){})}),this.getShareList()},check:function(){var e=this;return o()(i.a.mark(function t(){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.a.checkNodeState(!1);case 2:r.a.data.nodeStatus&&e.init();case 3:case"end":return t.stop()}},t,e)}))()}},mounted:function(){this.check()}},c={render:function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("section",{staticClass:"content app_main"},[l("el-row",{staticClass:"app_main_header_row"},[l("el-col",{attrs:{span:3}},[l("el-button",{staticClass:"btn",staticStyle:{width:"150px"},attrs:{type:"primary"},on:{click:function(t){return e.showDeploy()}}},[e._v("部署存证智能合约")])],1),e._v(" "),l("el-col",{staticClass:"head-icon",attrs:{span:21}},[l("a",{attrs:{target:"blank",href:"https://weidentity.readthedocs.io/zh_CN/latest/docs/weidentity-quick-tools-web.html?highlight=Evidence#evidence"}},[l("img",{staticClass:"icon_question",attrs:{src:a("JaJV"),alt:""}}),e._v(" "),l("span",{staticClass:"icon_question"},[e._v("存证智能合约部署使用教程")])])])],1),e._v(" "),l("div",{staticClass:"app_view"},[l("el-table",{staticStyle:{width:"100%"},attrs:{data:e.page.deployList.slice((e.page.pageIndex-1)*e.page.pageSize,e.page.pageIndex*e.page.pageSize),border:"true",align:"center",cellpadding:"0",cellspacing:"0"}},[l("el-table-column",{attrs:{prop:"evidenceName",label:"应用名字",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("span",{staticClass:"long_words",attrs:{title:t.row.evidenceName}},[e._v(e._s(t.row.evidenceName))])]}}])}),e._v(" "),l("el-table-column",{attrs:{label:"智能合约部署ID",align:"center",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("span",{staticClass:"long_words link",attrs:{title:t.row.hash},on:{click:function(a){return e.showAll(t.row.hash)}}},[e._v(e._s(t.row.hashShow))])]}}])}),e._v(" "),l("el-table-column",{attrs:{label:"部署的机构名称",align:"center",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return null!==t.row.issuer?[l("span",{staticClass:"icon_question",attrs:{title:t.row.issuer.name}},[e._v(e._s(t.row.issuer.name))]),e._v(" "),!0===t.row.issuer.recognized?l("img",{staticClass:"icon_question",attrs:{src:a("MeCv"),widht:"50",height:"50",alt:""}}):e._e(),e._v(" "),!1===t.row.issuer.recognized?l("img",{staticClass:"icon_question",attrs:{src:a("B7UN"),widht:"50",height:"50",alt:""}}):e._e()]:void 0}}],null,!0)}),e._v(" "),l("el-table-column",{attrs:{prop:"showGroupId",label:"所在群组",align:"center",width:"100"}}),e._v(" "),l("el-table-column",{attrs:{prop:"createTime",label:"创建时间",align:"center",width:"170"}}),e._v(" "),l("el-table-column",{attrs:{label:"操作",align:"center",width:"420"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.enable?l("el-button",{staticClass:"btn",attrs:{type:"primary",disabled:""}},[e._v("已启用")]):l("el-button",{staticClass:"btn",attrs:{type:"primary"},on:{click:function(a){return e.enable(t.row.hash,t.row.groupId,a)}}},[e._v("启用")]),e._v(" "),l("el-button",{staticClass:"btn",attrs:{type:"primary"},on:{click:function(a){return e.deleteRow(t.row.hash,a)}}},[e._v("删除")]),e._v(" "),l("el-button",{staticClass:"btn",staticStyle:{width:"90px"},attrs:{type:"primary"},on:{click:function(a){return e.showDeployDetail(t.row.hash,t.row.owner)}}},[e._v("详细信息")]),e._v(" "),l("el-button",{staticClass:"btn",staticStyle:{width:"120px"},attrs:{type:"primary"},on:{click:function(a){return e.getUserListByHash(t.row.hash)}}},[e._v("启用机构列表")])]}}])})],1),e._v(" "),l("el-pagination",{attrs:{"current-page":e.page.pageIndex,"page-size":e.page.pageSize,layout:"total, prev, pager, next, jumper",total:e.page.total},on:{"current-change":e.indexChange}})],1),e._v(" "),l("el-dialog",{staticClass:"dialog-view",attrs:{title:"启用的机构列表",width:"48%",visible:e.dialog.dialogTableVisible},on:{"update:visible":function(t){return e.$set(e.dialog,"dialogTableVisible",t)}}},[l("el-table",{attrs:{data:e.dialog.userListPage.userList.slice((e.dialog.userListPage.pageIndex-1)*e.dialog.userListPage.pageSize,e.dialog.userListPage.pageIndex*e.dialog.userListPage.pageSize),border:"true",cellpadding:"0",cellspacing:"0"}},[l("el-table-column",{attrs:{property:"name",label:"权威机构名称",width:"250"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(t.row.name)+"\n          "),!0===t.row.recognized?l("img",{staticClass:"icon_question",attrs:{src:a("MeCv"),widht:"50",height:"50",alt:""}}):e._e(),e._v(" "),!1===t.row.recognized?l("img",{staticClass:"icon_question",attrs:{src:a("B7UN"),widht:"50",height:"50",alt:""}}):e._e()]}}])}),e._v(" "),l("el-table-column",{attrs:{property:"weId",label:"WeID"}})],1),e._v(" "),l("el-pagination",{attrs:{"current-page":e.dialog.userListPage.pageIndex,"page-size":e.dialog.userListPage.pageSize,layout:"total, prev, pager, next, jumper",total:e.dialog.userListPage.total},on:{"current-change":e.indexChange2}}),e._v(" "),l("br")],1),e._v(" "),l("el-dialog",{staticClass:"dialog-view",attrs:{title:"部署存证智能合约",width:"33%",visible:e.dialog.dialogFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){return e.$set(e.dialog,"dialogFormVisible",t)}}},[l("div",{staticClass:"dialog-body"},[l("el-form",{attrs:{model:e.dialog.deployForm}},[l("el-form-item",{attrs:{label:"选择将存证合约部署到哪一个FISCO-BCOS群组ID（group ID）","label-width":e.formLabelWidth}},[l("div",{staticClass:"mark-text"},[l("div",[e._v("说明:")]),e._v(" "),l("div",[e._v("1. 找不到想找要的FISCO-BCOS群组ID？请确认下是否已经完成群组的部署。")]),e._v(" "),l("div",[e._v("2. 只能在“非主群组”上部署存证智能合约，主群组上的存证智能合约不能随意替换。")])]),e._v(" "),l("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"群组"},model:{value:e.dialog.deployForm.groupId,callback:function(t){e.$set(e.dialog.deployForm,"groupId",t)},expression:"dialog.deployForm.groupId"}},e._l(e.dialog.groupList,function(e){return l("el-option",{key:e.value,attrs:{label:e.value,value:e.value}})}),1)],1),e._v(" "),l("el-form-item",{attrs:{label:"存证应用名字","label-width":e.formLabelWidth}},[l("div",{staticClass:"mark-text"},[l("span",[e._v("给存证区块链应用起一个名字吧，用于不同的存证使用场景，例如“学历证书应用存证”。")])]),e._v(" "),l("el-input",{attrs:{placeholder:"Enter evidenceName"},model:{value:e.dialog.deployForm.evidenceName,callback:function(t){e.$set(e.dialog.deployForm,"evidenceName",t)},expression:"dialog.deployForm.evidenceName"}})],1)],1)],1),e._v(" "),l("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[l("el-button",{staticClass:"width_100",attrs:{type:"primary"},on:{click:function(t){return e.deployEvidence(t)}}},[e._v("部 署")])],1)]),e._v(" "),l("el-dialog",{staticClass:"dialog-view",attrs:{title:"部署信息",width:"620px",visible:e.dialog.dialogDetailVisible,"close-on-click-modal":!0},on:{"update:visible":function(t){return e.$set(e.dialog,"dialogDetailVisible",t)}}},[l("div",{staticClass:"dialog-body deployDetail"},[l("el-row",[l("el-col",{staticClass:"title",attrs:{span:4}},[e._v("智能合约部署ID")]),e._v(" "),l("el-col",{staticClass:"value",attrs:{span:20}},[e._v(e._s(e.dialog.deployDetail.hash))])],1),e._v(" "),l("el-row",[l("el-col",{staticClass:"title",attrs:{span:4}},[e._v("部署账户")]),e._v(" "),l("el-col",{staticClass:"value",attrs:{span:20}},[e._v(e._s(e.dialog.deployDetail.owner))])],1),e._v(" "),l("el-row",[l("el-col",{staticClass:"title",attrs:{span:4}},[e._v("群组")]),e._v(" "),l("el-col",{staticClass:"value",attrs:{span:20}},[e._v(e._s(e.dialog.deployDetail.groupId))])],1),e._v(" "),e.dialog.deployDetail.local?l("el-row",[l("el-col",{staticClass:"title",attrs:{span:4}},[e._v("WeID SDK版本")]),e._v(" "),l("el-col",{staticClass:"value",attrs:{span:7}},[e._v(e._s(e.dialog.deployDetail.weIdSdkVersion))]),e._v(" "),l("el-col",{staticClass:"title",attrs:{span:4}},[e._v("WeID合约版本")]),e._v(" "),l("el-col",{staticClass:"value",attrs:{span:9}},[e._v(e._s(e.dialog.deployDetail.contractVersion))])],1):e._e(),e._v(" "),e.dialog.deployDetail.local?l("el-row",[l("el-col",{staticClass:"title",attrs:{span:4}},[e._v("部署来源")]),e._v(" "),l("el-col",{staticClass:"value",attrs:{span:7}},[e._v(e._s(e.dialog.deployDetail.from))]),e._v(" "),l("el-col",{staticClass:"title",attrs:{span:4}},[e._v("区块链节点版本")]),e._v(" "),l("el-col",{staticClass:"value",attrs:{span:9}},[e._v(e._s(e.dialog.deployDetail.nodeVerion))])],1):e._e(),e._v(" "),e.dialog.deployDetail.local?l("el-row",[l("el-col",{staticClass:"title",attrs:{span:5}},[e._v("区块链节点")]),e._v(" "),l("el-col",{staticClass:"value",attrs:{span:19}},[e._v(e._s(e.dialog.deployDetail.nodeAddress))])],1):e._e(),e._v(" "),l("el-row",{staticClass:"none-border"},[l("el-col",{staticClass:"title",attrs:{span:5}},[e._v("存证智能合约地址")]),e._v(" "),l("el-col",{staticClass:"value",attrs:{span:19}},[e._v(e._s(e.dialog.deployDetail.evidenceAddress))])],1)],1),e._v(" "),l("br")]),e._v(" "),l("el-dialog",{staticClass:"dialog-view",attrs:{title:"存证合约部署",width:"400px",visible:e.dialog.dialogDepolyDetailVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){return e.$set(e.dialog,"dialogDepolyDetailVisible",t)}}},[l("div",{staticClass:"dialog-body deployMessage"},e._l(e.dialog.deployMessages,function(t){return l("p",{key:t.value},[e._v(e._s(t))])}),0),e._v(" "),l("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[l("el-button",{staticClass:"width_100",attrs:{type:"primary"},on:{click:e.comfirmBtn}},[e._v("确 定")])],1)])],1)},staticRenderFns:[]},g=a("C7Lr")(d,c,!1,null,null,null);t.default=g.exports}});