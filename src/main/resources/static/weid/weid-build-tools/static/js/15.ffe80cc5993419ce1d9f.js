webpackJsonp([15],{b3Cu:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("/p82"),i={data:function(){return{dbForm:{persistence_type:"",mysql_address:"",mysql_database:"",mysql_username:"",mysql_password:"",redis_address:"",redis_password:""},dialog:{checkDetailVisible:!1,checkMessages:[],nextBtn:null}}},methods:{checkInput:function(){if("mysql"===this.dbForm.persistence_type){if(""===this.dbForm.mysql_address)return this.$alert("请输入数据库 IP 和 PORT !","温馨提示",{}).catch(function(){}),!1;if(""===this.dbForm.mysql_database)return this.$alert("请输入数据库名称!","温馨提示",{}).catch(function(){}),!1;if(""===this.dbForm.mysql_username)return this.$alert("请输入数据库用户名!","温馨提示",{}).catch(function(){}),!1;if(""===this.dbForm.mysql_password)return this.$alert("请输入数据库密码!","温馨提示",{}).catch(function(){}),!1}else if(""===this.dbForm.redis_address)return this.$alert("请输入Redis的服务 IP 和 PORT !","温馨提示",{}).catch(function(){}),!1;return!0},checkPersistence:function(){var e=this;this.dialog.checkDetailVisible=!0,this.dialog.checkMessages.push("数据库配置检测中..."),a.a.doGet("checkPersistence").then(function(t){e.dialog.checkDetailVisible=!0,e.enableBtn(e.dialog.nextBtn),t.data.result?(e.dialog.checkMessages.push("数据库配置检测成功。"),e.dialog.checkMessages.push("提示：目前暂不支持修改配置动态实时生效，修改配置需重启服务才能生效")):e.dialog.checkMessages.push("数据库配置检测失败。")})},submitDbConfig:function(e){var t=this;this.checkInput()&&(this.dialog.nextBtn=e.currentTarget,this.dialog.checkMessages=[],this.dialog.checkDetailVisible=!0,this.dialog.checkMessages.push("数据库配置提交中..."),this.disableBtn(this.dialog.nextBtn),a.a.doPost("submitDbConfig",this.dbForm).then(function(e){t.dialog.checkDetailVisible=!0,0===e.data.errorCode?(t.dialog.checkMessages.push("数据库配置提交成功。"),t.checkPersistence()):(t.dialog.checkMessages.push("数据库配置提交失败。"),t.enableBtn(t.dialog.nextBtn))}))},init:function(){var e=this;a.a.doGet("loadConfig").then(function(t){0===t.data.errorCode&&(e.dbForm=t.data.result,"mysql"!==e.dbForm.persistence_type&&"redis"!==e.dbForm.persistence_type&&(e.dbForm.persistence_type="mysql"))})}},mounted:function(){this.init()}},l={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("section",{staticClass:"content section_main"},[s("div",{staticClass:"box",staticStyle:{width:"55%","margin-left":"200px"}},[s("div",{staticClass:"card card-primary warning_box"},[e._m(0),e._v(" "),s("div",{staticClass:"card-body"},[s("el-form",{ref:"dbForm",attrs:{"label-position":"right",model:e.dbForm,"label-width":"150px","inline-message":"true"}},[s("el-form-item",{attrs:{label:"数据库类型:",prop:"persistence_type"}},[s("el-select",{staticStyle:{width:"72%"},attrs:{placeholder:"数据库类型"},on:{change:e.resetValidate},model:{value:e.dbForm.persistence_type,callback:function(t){e.$set(e.dbForm,"persistence_type",t)},expression:"dbForm.persistence_type"}},[s("el-option",{attrs:{label:"mysql",value:"mysql"}}),e._v(" "),s("el-option",{attrs:{label:"redis",value:"redis"}})],1),e._v(" "),s("div",{staticClass:"mark-bottom"},[s("span",[e._v("目前暂只支持MySql与Redis数据库")])])],1),e._v(" "),"mysql"===e.dbForm.persistence_type?s("div",{attrs:{id:"mysqlForm"}},[s("el-form-item",{attrs:{label:"数据库IP:PORT:",prop:"mysql_address"}},[s("el-input",{staticStyle:{width:"72%"},attrs:{placeholder:"IP:PORT",onKeyUp:"value=value=value.replace(/[^0-9：:。.]/g,'');value=value.replace(/[。]/g,'.');value=value.replace(/[：]/g,':');value=value.replace(/\\s+/g,'');"},on:{blur:function(t){e.dbForm.mysql_address=t.target.value}},model:{value:e.dbForm.mysql_address,callback:function(t){e.$set(e.dbForm,"mysql_address",t)},expression:"dbForm.mysql_address"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"数据库名称:",prop:"mysql_database"}},[s("el-input",{staticStyle:{width:"72%"},attrs:{placeholder:"Enter DataBase Name"},model:{value:e.dbForm.mysql_database,callback:function(t){e.$set(e.dbForm,"mysql_database",t)},expression:"dbForm.mysql_database"}}),e._v(" "),s("div",{staticClass:"mark-bottom"},[s("span",[e._v("* 数据库需要提前自己搭建好，并建立好数据库，数据库名称(DataBase Name)可以自行决定")])])],1),e._v(" "),s("el-form-item",{attrs:{label:"数据库用户名:",prop:"mysql_username"}},[s("el-input",{staticStyle:{width:"72%"},attrs:{placeholder:"Enter username"},model:{value:e.dbForm.mysql_username,callback:function(t){e.$set(e.dbForm,"mysql_username",t)},expression:"dbForm.mysql_username"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"数据库密码:",prop:"mysql_password"}},[s("el-input",{staticStyle:{width:"72%"},attrs:{type:"password",placeholder:"Enter password"},model:{value:e.dbForm.mysql_password,callback:function(t){e.$set(e.dbForm,"mysql_password",t)},expression:"dbForm.mysql_password"}})],1)],1):e._e(),e._v(" "),"redis"===e.dbForm.persistence_type?s("div",{attrs:{id:"redisForm"}},[s("el-form-item",{attrs:{label:"服务器IP:PORT:",prop:"redis_address"}},[s("el-input",{staticStyle:{width:"72%"},attrs:{placeholder:"IP:PORT,IP:PORT",onKeyUp:"value=value=value.replace(/[^0-9：:，,。.]/g,'');value=value.replace(/[。]/g,'.');value=value.replace(/[：]/g,':');value=value.replace(/\\s+/g,'');value=value.replace(/[，]/g,',');"},on:{blur:function(t){e.dbForm.redis_address=t.target.value}},model:{value:e.dbForm.redis_address,callback:function(t){e.$set(e.dbForm,"redis_address",t)},expression:"dbForm.redis_address"}}),e._v(" "),s("div",{staticClass:"mark-bottom"},[s("span",[e._v('如：127.0.0.1:6379 ；如果多个节点，则请用半角逗号","分割：127.0.0.1:7100,127.0.0.1:7101')])])],1),e._v(" "),s("el-form-item",{attrs:{label:"服务器密码（选填):",prop:"redis_password"}},[s("el-input",{staticStyle:{width:"72%"},attrs:{type:"password",placeholder:"Enter password"},model:{value:e.dbForm.redis_password,callback:function(t){e.$set(e.dbForm,"redis_password",t)},expression:"dbForm.redis_password"}}),e._v(" "),s("div",{staticClass:"mark-bottom"},[s("span",[e._v("如未设置密码可不填写")])])],1)],1):e._e(),e._v(" "),s("div",{staticClass:"db-part"},[s("el-button",{staticClass:"btn btn_150",attrs:{type:"primary"},on:{click:function(t){return e.submitDbConfig(t)}}},[e._v("完成")])],1)],1),e._v(" "),e._m(1)],1)])]),e._v(" "),s("el-dialog",{staticClass:"dialog-view",attrs:{title:"温馨提示",width:"400px",visible:e.dialog.checkDetailVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){return e.$set(e.dialog,"checkDetailVisible",t)}}},[s("div",{staticClass:"dialog-body deployMessage"},e._l(e.dialog.checkMessages,function(t){return s("p",{key:t.value},[e._v(e._s(t))])}),0),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{staticClass:"width_100",attrs:{type:"primary"},on:{click:function(t){e.dialog.checkDetailVisible=!1}}},[e._v("完成")])],1)])],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"card-header"},[t("h3",[this._v("数据库配置")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"sql_warning bg_color"},[a("div",{staticClass:"warning_title"},[e._v("温馨提示")]),e._v(" "),a("p",[e._v("如果您需要使用到下列功能，则需要配置数据库")]),e._v(" "),a("p",[e._v("1.Transportation相关组件功能")]),e._v(" "),a("p",[e._v("2.Evidence异步存证功能")]),e._v(" "),a("p",[e._v("3.Persistence数据存储功能(例如：存储Credential)")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://weidentity.readthedocs.io/zh_CN/latest/docs/deploy-via-web.html?highlight=配置数据库#db-configuration",target:"blank_"}},[a("img",{staticClass:"icon_question",attrs:{src:s("JaJV"),alt:""}}),e._v(" "),a("span",{staticClass:"icon_question",staticStyle:{color:"#017CFF","font-size":"12px",display:"inline-block"}},[e._v("配置教程")])])]),e._v(" "),a("p",[a("a",{attrs:{href:"https://weidentity.readthedocs.io/zh_CN/latest/docs/how-to-use-persistence.html",target:"blank_"}},[a("img",{staticClass:"icon_question",attrs:{src:s("JaJV"),alt:""}}),e._v(" "),a("span",{staticClass:"icon_question",staticStyle:{color:"#017CFF","font-size":"12px",display:"inline-block"}},[e._v("使用教程")])])])])}]},r=s("C7Lr")(i,l,!1,null,null,null);t.default=r.exports}});