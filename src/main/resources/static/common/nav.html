<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>WeId-Web-Tool</title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body class="hold-transition sidebar-mini layout-fixed">
<div class="wrapper">
  <!-- Navbar -->
  <nav class="main-header navbar navbar-expand navbar-white navbar-light">
    <!-- Left navbar links -->
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" data-widget="pushmenu" href="#"><i class="fas fa-bars"></i></a>
      </li>
      <!-- d-none d-sm-inline-block -->
      <li class="nav-item d-index">
        <a href="index.html" class="nav-link">主页</a>
      </li>
      <li class="nav-item">
        <a id="openLog" href="#" class="nav-link">后台日志</a>
      </li>
    </ul>
      
    <ul class="navbar-nav ml-auto" style="display: none">
      <li class="nav-item dropdown" style="float: right;">
        <a class="nav-link" data-toggle="dropdown" href="#">环境切换 : 生产环境</a>
        <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
          <div class="dropdown-divider"></div>
          <a href="#" class="dropdown-item"> 生产环境 (prd)</a>
          <div class="dropdown-divider"></div>
          <a href="#" class="dropdown-item"> 测试环境 (stg)</a>
          <div class="dropdown-divider"></div>
          <a href="#" class="dropdown-item"> 开发环境 (dev)</a>
        </div>
      </li>
    </ul>
    <ul class="navbar-nav ml-auto" style="display: none">
      <li class="nav-item dropdown" style="float: right;">
        <a class="nav-link" id="reBoot" href="#">服务重启</a>
      </li>
    </ul>
  </nav>
  <!-- /.navbar -->
</div>
</body>
<script>
$(document).ready(function(){
    $("#openLog").click(function(){
      var win = window.open("","logWin","width=800,height=500,top=300,left=500");
      if (win.location.href === "about:blank") {
          //窗口不存在
          win = window.open("log.html", "logWin","width=800,height=500,top=300,left=500");
      } else {
          //窗口以已经存在了
          win.focus();
      }
    })
    var times = 6;
    $("#reBoot").click(function(){
    	$.confirm("是否确定重启服务?",function(){
    		$.get("refresh",function(data,status){
                if (data) {
                	$('#modal-message').on('hide.bs.modal', function () {
                        goToIndex();
                    })
                    showTime();
                    setInterval(showTime,1000);
                    setTimeout(goToIndex,5000);
                } else {
                	$("#messageBody").html("<p>服务重启失败，请查看日志。</p>");
                    $("#modal-message").modal();
                }
            });
    	})
    })
    
    function showTime() {
        times--;
        $("#messageBody").html("<p>服务重启中，" + times + "秒后回到首页。</p>");
        $("#modal-message").modal();
    }
    function goToIndex() {
        window.location.href="index.html";
    }
})
</script>
</html>
